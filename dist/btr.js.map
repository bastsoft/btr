{"version":3,"sources":["../lib/import-gist.js","../lib/commands-queue.js","../lib/cy.js","../web/inquirer-ui.js","../web/fetch.js","btr.js"],"names":["fetchjsonp","document","gistId","then","data","files","el","createElement","innerHTML","div","gistFiles","querySelectorAll","i","length","html","outerHTML","text","textContent","Queue","propertyName","that","_queue","isRun","main","Commands","add","name","promiseFunction","args","runThroughQueue","bind","payload","push","run","shift","queue","message","Promise","resolve","reject","console","log","err","time","options","setTimeout","callback","cy","_elemId","_resolveCallback","_answers","prompt","promptsArray","type","_createList","listObj","menu","Math","random","toString","split","setAttribute","choices","forEach","answer","menuitem","addEventListener","_removeMenuById","appendChild","body","id","elem","getElementById","parentNode","removeChild","fetchscript","url","script","src","onreadystatechange","onload","String","fromCharCode","floor","Date","addSymbol","indexOf","handler","readyState","window","getElementsByTagName","e","btr","context","importGistId","inquirer","loadGist","gists","Function","file","load","loadModule","querySelector","head"],"mappings":"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","file":"btr.js","sourceRoot":"../src","sourcesContent":["export default function(fetchjsonp, document, gistId){\n    return fetchjsonp('https://gist.github.com/' + gistId + '.json').then(data=>{\n        var files = {};\n        var el = document.createElement('div');\n        el.innerHTML = data.div;\n  \n        var gistFiles = el.querySelectorAll('.gist-file .gist-data .file');\n  \n        for (var i = 0; i < gistFiles.length; i++) {\n            var fileName = data.files[i];\n            files[fileName] = {\n              html: gistFiles[i].outerHTML,\n              text: gistFiles[i].textContent,\n            };\n        }\n\n        return files;\n    });\n}","\nexport default class Queue {\n    constructor(propertyName) {   \n      const that = this;\n      this._queue = [];\n      this.isRun = false;\n      \n      const main = {\n        Commands: {\n          add(name, promiseFunction) {\n              main[propertyName][name] = (...args) => {\n                that.runThroughQueue(promiseFunction.bind(that, ...args));\n                \n                return main[propertyName];\n              };\n          }\n        },\n      };\n      \n      main[propertyName] = {};  \n       \n      return main;\n    }\n    \n    runThroughQueue(payload) {\n      this._queue.push(payload);\n      this.run();\n    }\n    \n    run() {\n      if (this._queue.length && !this.isRun) {\n          this.isRun = true;\n        \n          this._queue.shift()().then(() => {\n            this.isRun = false;\n            this.run();\n          });\n      }\n    }\n  };\n  ","export default function(Queue){\n    const queue = new Queue(\"cy\");\n\n    queue.Commands.add(\"log\", function(message) {\n      return new Promise((resolve, reject) => {\n        try {\n          console.log(message);\n          resolve();\n        }\n        catch (err) {\n          reject(err);\n        }\n      });\n    });\n    \n    queue.Commands.add(\"wait\", function(time, options) {\n      return new Promise((resolve, reject) => {\n        try {\n          setTimeout(() => {\n            resolve();\n          }, time);\n        }\n        catch (err) {\n          reject(err);\n        }\n      });\n    });\n    \n    queue.Commands.add(\"then\", function(callback) {\n      return new Promise((resolve, reject) => {\n        try {\n          callback();\n          resolve();\n        }\n        catch (err) {\n          reject(err);\n        }\n      });\n    });\n    \n    return queue.cy;\n}\n","export default {\n    _elemId: null,\n    _resolveCallback: null,\n    _answers:null,\n    \n    prompt: function(promptsArray){\n      this._answers = {};\n      \n      if(promptsArray[0].type === \"list\"){\n        this._createList(promptsArray[0]);\n      }\n      \n      return new Promise((resolve, reject) => {\n      try {\n        this._resolveCallback = resolve;\n      }\n      catch (err) {\n        reject(err);\n      }\n    });\n    },\n    \n    _createList(listObj){\n      const menu = document.createElement('ul');\n      \n      this._answers = {}; \n      this._resolveCallback = null;\n      this._elemId = Math.random().toString().split(\".\")[1];\n      \n      menu.setAttribute('id', this._elemId);\n      menu.setAttribute('style', '\\\n          z-index: 2147483000;\\\n          position:fixed;\\\n          list-style-type:none;\\\n          margin:0;\\\n          padding: 0;\\\n          font-family: monospace;\\\n          font-size: 14px;\\\n          cursor: pointer;\\\n          top: 0;\\\n          left: 0;\\\n      ');\n      \n      listObj.choices.forEach((answer)=>{\n        const menuitem = document.createElement('li');\n        \n        menuitem.innerHTML = answer;\n        \n        menuitem.setAttribute('style', '\\\n          background: #eee;\\\n          padding: 10px;\\\n        ');\n        menuitem.setAttribute('onmouseover', 'this.style.backgroundColor=\"#555\";');\n        menuitem.setAttribute('onmouseout', 'this.style.backgroundColor=\"#eee\";');\n        \n        menuitem.addEventListener(\"click\", ()=>{\n            this._removeMenuById(this._elemId);\n              \n            if(this._resolveCallback ){\n              this._answers[listObj.name] = answer;\n              this._resolveCallback(this._answers);\n              this._resolveCallback = null;\n            }\n         }, false);\n        menu.appendChild(menuitem);\n      });\n      \n      document.body.appendChild(menu);\n    },\n    \n    _removeMenuById(id){\n      const elem = document.getElementById(id);\n      \n      elem.parentNode.removeChild(elem);\n    }\n  }\n  ","export function fetchscript(url, callback) {\n    var script = document.createElement('script');\n\n    script.type = 'text/javascript';\n    script.src = url;\n\n    if (callback) {\n        script.onreadystatechange = callback;\n        script.onload = callback;\n    }\n\n    return script;\n}\n\nexport function fetchjsonp(url) {\n    return new Promise(function(resolve, reject) {\n        try{\n            const id = String.fromCharCode(65 + Math.floor(Math.random() * 26)) + (+(new Date));\n            const addSymbol = url.indexOf(\"?\") !== -1 ? \"&\" : \"?\";\n            const handler = fetchscript.bind(this, url + addSymbol + 'callback=fun' + id);\n            const elem = handler(function () {\n                if (elem.readyState && elem.readyState !== \"complete\" && elem.readyState !== \"loaded\") {\n                    return false;\n                }\n\n                elem.parentNode.removeChild(elem);\n            });\n        \n            window['fun' + id] = function (data) {\n                resolve(data);\n                window['fun' + id] = null;\n            };\n\n            document.getElementsByTagName('head')[0].appendChild(elem);\n        }catch(e){\n            reject(e);\n        }\n    });\n}","import importGistId from \"../lib/import-gist.js\"\nimport Queue from \"../lib/commands-queue.js\";\nimport getCy from \"../lib/cy.js\";\n\nimport inquirer from \"../web/inquirer-ui.js\";\nimport {fetchjsonp} from \"../web/fetch.js\";\n\nwindow.btr = {};\n\nbtr.context = {\n    importGistId,\n    cy : getCy(Queue),\n    inquirer,\n    fetchjsonp,\n    document\n};\n\nbtr.loadGist = function(data){\n    importGistId(fetchjsonp, document, data.id).then(gists => {\n        const load = new Function('{ importGistId, cy, inquirer, fetchjsonp, document}',  gists[data.file].text);\n        load(btr.context);\n    });\n};\n\nbtr.loadModule = function(url){\n    const script = document.createElement('script');\n    const id = String.fromCharCode(65 + Math.floor(Math.random() * 26)) + (+(new Date));\n\n    window['delete' + id] = ()=>{\n      console.log('delete' + id);\n      const elem = document.querySelector(\"#\" + id);\n      elem.parentNode.removeChild(elem);\n      \n      delete window['delete' + id];\n    };\n\n    script.type = 'module';\n    script.id = id;\n    script.text = `\n    import exapleMenu1 from \"${url}\";\n    \n    exapleMenu1(btr.context);\n\n    delete${id}();\n    `;\n\n    script.onreadystatechange = onload;\n    script.onload = onload;\n    \n\n    document.head.appendChild(script);\n  };\n"]}